ガベージコレクタの不適切な使用について
===================

> id: '842e30ab-1af1-4152-ba0f-3004ca3b620f'
> slug:
> 	cs: senior-8-garbage-collector
> 	ja: gabejikorekutano-bu-shi-qiena-shi-yongnitsuite
> 
> publicationDate: '2023-02-11 14:35:00'
> mainCategoryId: '8b6e2597-bee1-45d5-b0bf-48ccb2d0d94a'
> sourceContentHash: ae5993313436e0d7c5291b6337b988ef

あなたは大規模なレガシーアプリケーションの開発者であり、そこにPHPStanを徐々に導入しています。レベル0からスタートするので、かなり難易度が高いですが、最終的にはうまくいきます。次のレベルに進むと、コードの一部が未使用の$lock変数を報告し始め、それを削除する必要があります。

コードは次のようになります。

```php
public function processOrder(int $orderId): void
{
	$lock = Lock::createLock('じゅんじょせい' . $orderId);

	// ここには論理がある...
}
```

変数にロックがかかっていて、誰かが後で解除するのを忘れたか、後で呼ばれる他のメソッドの中で起こっているに違いないと自分に言い聞かせるのです。そこで、未使用の変数を削除し、ロックを作成する静的メソッドの呼び出しだけを残すことにしました。

この判断がクリティカルエラーの原因になるのでは？

もしそうなら、その理由と、本来の仕組みはどうだったのだろうか。

そうでない場合は、なぜそうなのか、また、常に安全な動作であることをどのように確認するのか。
